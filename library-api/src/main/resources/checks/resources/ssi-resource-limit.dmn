<?xml version="1.0" encoding="UTF-8"?>
<dmn:definitions xmlns:dmn="http://www.omg.org/spec/DMN/20180521/MODEL/"
                 xmlns="https://kie.apache.org/dmn/_C471DC1E-D0A3-4C2A-B270-834758321D16"
                 xmlns:feel="http://www.omg.org/spec/DMN/20180521/FEEL/"
                 xmlns:kie="http://www.drools.org/kie/dmn/1.2"
                 xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI/"
                 id="_A5B6C7D8-E9F0-1A2B-3C4D-5E6F7A8B9C0D"
                 name="SsiResourceLimit"
                 typeLanguage="http://www.omg.org/spec/DMN/20180521/FEEL/"
                 namespace="https://kie.apache.org/dmn/_C471DC1E-D0A3-4C2A-B270-834758321D16">

  <dmn:description>POMS SI 01110.003 - SSI resource limit check
- Individual limit: $2,000
- Couple limit: $3,000

Countable resources must be below the applicable limit for SSI eligibility</dmn:description>

  <!-- Import BDT base module -->
  <dmn:import id="_B7C8D9E0-F1A2-3B4C-5D6E-7F8A9B0C1D2E"
              name="BDT"
              namespace="https://kie.apache.org/dmn/_1B91A885-130A-4E0B-A762-E12AA6DD5C79"
              locationURI="../../BDT.dmn"
              importType="http://www.omg.org/spec/DMN/20180521/MODEL/"/>

  <!-- Parameters type definition -->
  <dmn:itemDefinition id="_C8D9E0F1-2A3B-4C5D-6E7F-8A9B0C1D2E3F" name="tParameters" isCollection="false">
    <dmn:itemComponent id="_D9E0F1A2-3B4C-5D6E-7F8A-9B0C1D2E3F4A" name="personId" isCollection="false">
      <dmn:typeRef>string</dmn:typeRef>
    </dmn:itemComponent>
    <dmn:itemComponent id="_E9F0A1B2-4C5D-6E7F-8A9B-0C1D2E3F4A5B" name="isCouple" isCollection="false">
      <dmn:typeRef>boolean</dmn:typeRef>
    </dmn:itemComponent>
  </dmn:itemDefinition>

  <!-- Input: situation -->
  <dmn:inputData id="_E0F1A2B3-4C5D-6E7F-8A9B-0C1D2E3F4A5B" name="situation">
    <dmn:extensionElements/>
    <dmn:variable id="_F1A2B3C4-5D6E-7F8A-9B0C-1D2E3F4A5B6C"
                  name="situation"
                  typeRef="BDT.tSituation"/>
  </dmn:inputData>

  <!-- Input: parameters -->
  <dmn:inputData id="_A2B3C4D5-6E7F-8A9B-0C1D-2E3F4A5B6C7D" name="parameters">
    <dmn:extensionElements/>
    <dmn:variable id="_B3C4D5E6-7F8A-9B0C-1D2E-3F4A5B6C7D8E"
                  name="parameters"
                  typeRef="tParameters"/>
  </dmn:inputData>

  <!-- Decision: checkResult -->
  <dmn:decision id="_C4D5E6F7-8A9B-0C1D-2E3F-4A5B6C7D8E9F" name="checkResult">
    <dmn:description>POMS SI 01110.003 - Countable resources must be less than limit ($2,000 individual, $3,000 couple)</dmn:description>
    <dmn:extensionElements/>
    <dmn:variable id="_D5E6F7A8-9B0C-1D2E-3F4A-5B6C7D8E9F0A"
                  name="checkResult"
                  typeRef="boolean"/>
    <dmn:informationRequirement id="_E6F7A8B9-0C1D-2E3F-4A5B-6C7D8E9F0A1B">
      <dmn:requiredInput href="#_E0F1A2B3-4C5D-6E7F-8A9B-0C1D2E3F4A5B"/>
    </dmn:informationRequirement>
    <dmn:informationRequirement id="_F7A8B9C0-1D2E-3F4A-5B6C-7D8E9F0A1B2C">
      <dmn:requiredInput href="#_A2B3C4D5-6E7F-8A9B-0C1D-2E3F4A5B6C7D"/>
    </dmn:informationRequirement>

    <dmn:context id="_A8B9C0D1-2E3F-4A5B-6C7D-8E9F0A1B2C3D">
      <!-- Step 1: Extract primary person -->
      <dmn:contextEntry>
        <dmn:variable id="_B9C0D1E2-3F4A-5B6C-7D8E-9F0A1B2C3D4E" name="person" typeRef="BDT.tPerson"/>
        <dmn:literalExpression id="_C0D1E2F3-4A5B-6C7D-8E9F-0A1B2C3D4E5F">
          <dmn:text>situation.people[id = parameters.personId][1]</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 2: Extract countable resources -->
      <dmn:contextEntry>
        <dmn:variable id="_D1E2F3A4-5B6C-7D8E-9F0A-1B2C3D4E5F6A" name="countableResources" typeRef="number"/>
        <dmn:literalExpression id="_E2F3A4B5-6C7D-8E9F-0A1B-2C3D4E5F6A7B">
          <dmn:text>person.countableResources</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 3: Determine resource limit based on couple status -->
      <dmn:contextEntry>
        <dmn:variable id="_G4A5B6C7-8D9E-0F1A-2B3C-4D5E6F7A8B9C" name="resourceLimit" typeRef="number"/>
        <dmn:literalExpression id="_H5B6C7D8-9E0F-1A2B-3C4D-5E6F7A8B9C0D">
          <dmn:text>if parameters.isCouple then 3000 else 2000</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 4: Check if resources are below limit -->
      <dmn:contextEntry>
        <dmn:variable id="_F3A4B5C6-7D8E-9F0A-1B2C-3D4E5F6A7B8C" name="result" typeRef="boolean"/>
        <dmn:literalExpression id="_A4B5C6D7-8E9F-0A1B-2C3D-4E5F6A7B8C9D">
          <dmn:text>if countableResources = null then
  null
else
  countableResources &lt; resourceLimit</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 5: Return result -->
      <dmn:contextEntry>
        <dmn:literalExpression id="_B5C6D7E8-9F0A-1B2C-3D4E-5F6A7B8C9D0E">
          <dmn:text>result</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>
    </dmn:context>
  </dmn:decision>

  <!-- Decision Service -->
  <dmn:decisionService id="_C6D7E8F9-0A1B-2C3D-4E5F-6A7B8C9D0E1F" name="SsiResourceLimitService">
    <dmn:extensionElements/>
    <dmn:variable id="_D7E8F9A0-1B2C-3D4E-5F6A-7B8C9D0E1F2A"
                  name="SsiResourceLimitService"
                  typeRef="BDT.tCheckResponse"/>
    <dmn:outputDecision href="#_C4D5E6F7-8A9B-0C1D-2E3F-4A5B6C7D8E9F"/>
    <dmn:inputData href="#_E0F1A2B3-4C5D-6E7F-8A9B-0C1D2E3F4A5B"/>
    <dmn:inputData href="#_A2B3C4D5-6E7F-8A9B-0C1D-2E3F4A5B6C7D"/>
  </dmn:decisionService>

</dmn:definitions>
