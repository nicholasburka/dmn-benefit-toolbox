<?xml version="1.0" encoding="UTF-8"?>
<dmn:definitions
  xmlns:dmn="http://www.omg.org/spec/DMN/20180521/MODEL/"
  xmlns="https://kie.apache.org/dmn/_A1B2C3D4-5E6F-7A8B-9C0D-1E2F3A4B5C6D"
  xmlns:feel="http://www.omg.org/spec/DMN/20180521/FEEL/"
  xmlns:kie="http://www.drools.org/kie/dmn/1.2"
  xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI/"
  xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/"
  xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
  id="_8F7E6D5C-4B3A-2918-7C6B-5A4E3D2C1B0A"
  name="PermanentResidentQualified"
  typeLanguage="http://www.omg.org/spec/DMN/20180521/FEEL/"
  namespace="https://kie.apache.org/dmn/_A1B2C3D4-5E6F-7A8B-9C0D-1E2F3A4B5C6D">

  <dmn:description>Implements SSI permanent resident citizenship requirements from POMS SI 00502.100

NOTE: This is a simplified implementation that checks LAPR status only. Per POMS SI 00502.100 and SI 00502.135,
LAPR aliens must ALSO meet an exception condition to be SSI-eligible:
  - 40 qualifying quarters (with 5-year bar for entry after 8/22/96)
  - Veteran/active duty military exception
  - Receiving SSI on 8/22/96
  - Other exceptions per SI 00502.100A.3

Future enhancement: Implement exception condition logic.</dmn:description>

  <!-- Import BDT (required) -->
  <dmn:import
    id="_1A2B3C4D-5E6F-7A8B-9C0D-1E2F3A4B5C6D"
    name="BDT"
    namespace="https://kie.apache.org/dmn/_1B91A885-130A-4E0B-A762-E12AA6DD5C79"
    locationURI="../../bdt.dmn"
    importType="http://www.omg.org/spec/DMN/20180521/MODEL/"/>

  <!-- Define tParameters (check-specific inputs) -->
  <dmn:itemDefinition id="_2B3C4D5E-6F7A-8B9C-0D1E-2F3A4B5C6D7E" name="tParameters" isCollection="false">
    <dmn:itemComponent id="_3C4D5E6F-7A8B-9C0D-1E2F-3A4B5C6D7E8F" name="personId" isCollection="false">
      <dmn:typeRef>string</dmn:typeRef>
    </dmn:itemComponent>
  </dmn:itemDefinition>

  <!-- Decision Service (MUST be {ModelName}Service) -->
  <dmn:decisionService id="_4D5E6F7A-8B9C-0D1E-2F3A-4B5C6D7E8F9A" name="PermanentResidentQualifiedService">
    <dmn:extensionElements/>
    <dmn:variable id="_5E6F7A8B-9C0D-1E2F-3A4B-5C6D7E8F9A0B"
                  name="PermanentResidentQualifiedService"
                  typeRef="BDT.tCheckResponse"/>
    <dmn:outputDecision href="#_6F7A8B9C-0D1E-2F3A-4B5C-6D7E8F9A0B1C"/>
    <dmn:inputData href="#_7A8B9C0D-1E2F-3A4B-5C6D-7E8F9A0B1C2D"/>
    <dmn:inputData href="#_8B9C0D1E-2F3A-4B5C-6D7E-8F9A0B1C2D3E"/>
  </dmn:decisionService>

  <!-- Input Data: situation -->
  <dmn:inputData id="_8B9C0D1E-2F3A-4B5C-6D7E-8F9A0B1C2D3E" name="situation">
    <dmn:extensionElements/>
    <dmn:variable id="_9C0D1E2F-3A4B-5C6D-7E8F-9A0B1C2D3E4F"
                  name="situation"
                  typeRef="BDT.tSituation"/>
  </dmn:inputData>

  <!-- Input Data: parameters -->
  <dmn:inputData id="_7A8B9C0D-1E2F-3A4B-5C6D-7E8F9A0B1C2D" name="parameters">
    <dmn:extensionElements/>
    <dmn:variable id="_A0B1C2D3-E4F5-A6B7-C8D9-E0F1A2B3C4D5"
                  name="parameters"
                  typeRef="tParameters"/>
  </dmn:inputData>

  <!-- Decision: checkResult -->
  <dmn:decision id="_6F7A8B9C-0D1E-2F3A-4B5C-6D7E8F9A0B1C" name="checkResult">
    <dmn:description>POMS SI 00502.100A.2.a - Individual must be LAPR (Lawfully Admitted for Permanent Residence) for SSI qualified alien status.

This check verifies LAPR status only. Full SSI eligibility requires LAPR + exception condition (see POMS SI 00502.135 for 40 QQ exception, veteran exception, etc.).</dmn:description>
    <dmn:extensionElements/>
    <dmn:variable id="_B1C2D3E4-F5A6-B7C8-D9E0-F1A2B3C4D5E6"
                  name="checkResult"
                  typeRef="boolean"/>
    <dmn:informationRequirement id="_C2D3E4F5-A6B7-C8D9-E0F1-A2B3C4D5E6F7">
      <dmn:requiredInput href="#_8B9C0D1E-2F3A-4B5C-6D7E-8F9A0B1C2D3E"/>
    </dmn:informationRequirement>
    <dmn:informationRequirement id="_D3E4F5A6-B7C8-D9E0-F1A2-B3C4D5E6F7A8">
      <dmn:requiredInput href="#_7A8B9C0D-1E2F-3A4B-5C6D-7E8F9A0B1C2D"/>
    </dmn:informationRequirement>
    <dmn:context id="_E4F5A6B7-C8D9-E0F1-A2B3-C4D5E6F7A8B9">
      <!-- Step 1: Get person from situation -->
      <dmn:contextEntry>
        <dmn:variable id="_F5A6B7C8-D9E0-F1A2-B3C4-D5E6F7A8B9C0" name="person" typeRef="BDT.tPerson"/>
        <dmn:literalExpression id="_A6B7C8D9-E0F1-A2B3-C4D5-E6F7A8B9C0D1">
          <dmn:text>situation.people[id = parameters.personId][1]</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 2: Check LAPR status -->
      <dmn:contextEntry>
        <dmn:variable id="_B7C8D9E0-F1A2-B3C4-D5E6-F7A8B9C0D1E2" name="result" typeRef="boolean"/>
        <dmn:literalExpression id="_C8D9E0F1-A2B3-C4D5-E6F7-A8B9C0D1E2F3">
          <dmn:text>person.citizenshipStatus = "LAPR"</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 3: Return result -->
      <dmn:contextEntry>
        <dmn:literalExpression id="_D9E0F1A2-B3C4-D5E6-F7A8-B9C0D1E2F3A4">
          <dmn:text>result</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>
    </dmn:context>
  </dmn:decision>

</dmn:definitions>
