<?xml version="1.0" encoding="UTF-8"?>
<dmn:definitions
  xmlns:dmn="http://www.omg.org/spec/DMN/20180521/MODEL/"
  xmlns="https://kie.apache.org/dmn/_9A93C7FE-6B0B-4A21-8E68-39B35E4163D7"
  xmlns:feel="http://www.omg.org/spec/DMN/20180521/FEEL/"
  xmlns:kie="http://www.drools.org/kie/dmn/1.2"
  xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI/"
  xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/"
  xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
  id="_5923ED9B-7079-43E9-8095-BBBEABA43C6C"
  name="PersonUSCitizen"
  typeLanguage="http://www.omg.org/spec/DMN/20180521/FEEL/"
  namespace="https://kie.apache.org/dmn/_9A93C7FE-6B0B-4A21-8E68-39B35E4163D7">

  <dmn:description>Implements SSI citizenship requirements from POMS SI 00501.100</dmn:description>

  <!-- Import BDT (required) -->
  <dmn:import
    id="_EF75BFEC-FB05-4526-995A-26EFACFF19B8"
    name="BDT"
    namespace="https://kie.apache.org/dmn/_1B91A885-130A-4E0B-A762-E12AA6DD5C79"
    locationURI="../../bdt.dmn"
    importType="http://www.omg.org/spec/DMN/20180521/MODEL/"/>

  <!-- Define tParameters (check-specific inputs) -->
  <dmn:itemDefinition id="_BD9A8014-E08B-498C-95FA-424E2EA8EB9B" name="tParameters" isCollection="false">
    <dmn:itemComponent id="_4C714E8E-7427-40D9-B86C-9346293FC85E" name="personId" isCollection="false">
      <dmn:typeRef>string</dmn:typeRef>
    </dmn:itemComponent>
  </dmn:itemDefinition>

  <!-- Decision Service (MUST be {ModelName}Service) -->
  <dmn:decisionService id="_2B5C9AB8-7019-418A-8D93-03707C17D29A" name="PersonUSCitizenService">
    <dmn:extensionElements/>
    <dmn:variable id="_5897B994-4BC2-4B40-BD2E-B832721F4EAF"
                  name="PersonUSCitizenService"
                  typeRef="BDT.tCheckResponse"/>
    <dmn:outputDecision href="#_69256834-9A45-4B7E-A815-E1D26CBA45D1"/>
    <dmn:inputData href="#_AECE883B-81F7-4B16-9649-C15F393F32E4"/>
    <dmn:inputData href="#_697FB89B-63EE-403E-AF3E-BC49F1B8A81C"/>
  </dmn:decisionService>

  <!-- Input Data: situation -->
  <dmn:inputData id="_697FB89B-63EE-403E-AF3E-BC49F1B8A81C" name="situation">
    <dmn:extensionElements/>
    <dmn:variable id="_DB2AC4CB-7C40-4735-9152-B8732DDF368D"
                  name="situation"
                  typeRef="BDT.tSituation"/>
  </dmn:inputData>

  <!-- Input Data: parameters -->
  <dmn:inputData id="_AECE883B-81F7-4B16-9649-C15F393F32E4" name="parameters">
    <dmn:extensionElements/>
    <dmn:variable id="_0A5ED793-1933-409C-9F1A-7428D3928EB2"
                  name="parameters"
                  typeRef="tParameters"/>
  </dmn:inputData>

  <!-- Decision: checkResult -->
  <dmn:decision id="_69256834-9A45-4B7E-A815-E1D26CBA45D1" name="checkResult">
    <dmn:description>POMS SI 00501.100.A - Individual must be US citizen for SSI eligibility</dmn:description>
    <dmn:extensionElements/>
    <dmn:variable id="_336BBB80-B52A-408A-B0AB-1A4F56446693"
                  name="checkResult"
                  typeRef="boolean"/>
    <dmn:informationRequirement id="_9B03F8DC-27D7-4C0C-8BDF-94206914D6B3">
      <dmn:requiredInput href="#_697FB89B-63EE-403E-AF3E-BC49F1B8A81C"/>
    </dmn:informationRequirement>
    <dmn:informationRequirement id="_C3CC0CCC-B4E1-4C78-9438-D475FD00550E">
      <dmn:requiredInput href="#_AECE883B-81F7-4B16-9649-C15F393F32E4"/>
    </dmn:informationRequirement>
    <dmn:context id="_B499A169-67C3-4405-95A2-F5405AF19DC9">
      <!-- Step 1: Get person from situation -->
      <dmn:contextEntry>
        <dmn:variable id="_B49B8F85-5828-4851-B590-50F227A76944" name="person" typeRef="BDT.tPerson"/>
        <dmn:literalExpression id="_4C11ABE5-B19B-4C63-B46B-755FF3A6FACC">
          <dmn:text>situation.people[id = parameters.personId][1]</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 2: Check citizenship status -->
      <dmn:contextEntry>
        <dmn:variable id="_7AB98FB9-B5F2-41C9-8C46-B3B627AD3A25" name="result" typeRef="boolean"/>
        <dmn:literalExpression id="_0E389038-35B8-42FF-8FAD-4E26290F0B80">
          <dmn:text>person.citizenshipStatus = "US_CITIZEN"</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>

      <!-- Step 3: Return result -->
      <dmn:contextEntry>
        <dmn:literalExpression id="_7EA7F2D2-C943-48B3-BAFF-F748D93256F3">
          <dmn:text>result</dmn:text>
        </dmn:literalExpression>
      </dmn:contextEntry>
    </dmn:context>
  </dmn:decision>

</dmn:definitions>
